## 刷机包目录结构

```
├── compileinfo
├── NC-BOOT
├── loader
│   ├── MiniLoaderAll.bin			// loader固件
├── boards
│   ├── EMB-2582-V1.0				// 主板ID文件
│   ├── EMB-3582-V1.2				// 主板ID文件
├── tools
│   ├── linux
│   ├── windows
│   │   ├── DriverAssitant_v5.12
│   │   │   ├── DriverInstall.exe	// 驱动程序
│   │   └── RKDevTool
│   │       ├── RKDevTool_Release
│   │       │   ├── RKDevTool.exe	// 烧录工具
│   │       └── rockdev
│   │           ├── nc-pack.bat		// 打包脚本
│   │           ├── nc-unpack.bat	// 解包脚本
│   │           ├── Output
└── update.img						// 完整固件
```

## 刷机

### 刷机准备

**让主板进入烧录模式**

方式一：

在系统终端下执行 `reboot loader` 命令，主板会重启并进入烧录模式。

方式二：

参考主板使用说明，短接主板上的烧录模式跳冒，并给主板重新上电，主板就会进入烧录模式。

**连接烧录线**

参考主板使用说明，将主板的烧录口和 Windows 电脑的 USB 口通过一根 USB 烧录线进行连接。

**安装驱动**

Windows 系统下双击 DriverInstall.exe 进行驱动安装。

**烧录工具**

Windows 系统下双击 RKDevTool.exe 运行烧录工具。

当上述操作都准备就绪，烧录工具能识别到主板进入烧录模式，烧录工具界面就会提示 `发现一个LOADER设备` 或 `发现一个MASKROM设备`，这时就可以开始后续的烧录操作。

### 烧录完整固件

点击 `升级固件` --> 点击 `固件` 并选择完整固件 update.img --> 点击 `升级`。

### 烧录主板 ID

在设备处于 LOADER 模式下，可以单独烧录主板 ID。

点击 `下载镜像` --> 只勾选 board 一栏 --> 点击 board 路径后面一格并选择主板 ID 文件 --> 勾选 `强制按地址写` --> 点击 `执行`。

**注意**

如果主板未烧录过固件处于 MASKROM 模式，且希望在烧录完整固件之前先烧录主板 ID，则需先烧写 LOADER，否则不要烧写 LOADER。

点击 `下载镜像` --> 只勾选 loader 一栏 --> 点击 loader 路径后面一格并选择 loader 固件 --> 点击 `执行`。

### 烧录内核镜像

在设备处于 LOADER 模式下，可以单独烧录 boot 分区镜像或 rootfs 等其他分区镜像。

点击 `设备分区表` 读取设备分区信息 --> 只勾选 boot 一栏 --> 确认 boot 地址一格与设备分区地址一致 --> 点击 boot 路径后面一格并选择 boot.img --> 点击 `执行`。

### 问题排查

**问题**

烧录工具界面提示：`没有发现设备`。

**排查**

确认驱动是否已安装，且安装过程没有报错。

确认 USB 烧录线是否连接正确。参考主板使用说明。

确认主板是否已经进入烧录模式。参考主板使用说明。进入烧录模式的主板不会进入正常系统，可以通过接显示器、ssh 终端或串口终端来确认没有进入正常系统。

**调试**

尝试给主板重新上电。

尝试重新拔插 USB 烧录线。

尝试更换 USB 烧录线，有的 USB 烧录线接口接触不良，或者 USB 线材中只有供电线没有数据线。

尝试更换使用电脑的其他 USB 口，有的电脑 USB 口接触不良，或无法驱动。

尝试在电脑的 USB 口上加一个带供电的 USB HUB，有的电脑 USB 口供电不足。

尝试更换电脑，使用 Windows 10 系统。

**问题**

烧录工具界面提示：`发现一个ADB设备`。

**排查**

这种情况是，驱动安装成功，烧录线连接正常，烧录工具也识别到了主板，但主板没有工作在烧录模式。

**调试**

尝试按照上面的方法重新让主板进入烧录模式。

尝试点击烧录工具界面的 `切换` 按钮，让主板进入烧录模式。

## 制作完整固件

介绍如何将从主板中导出的 rootfs.img 制作成完整固件 update.img。

### 固件解包

Windows 系统下双击 nc-unpack.bat 进行解包。

解包后的各分区镜像保存在当前 Output 目录下。

### 替换 rootfs.img

手动将导出的 rootfs.img 拷贝替换到 Output 目录下。

### 固件打包

Windows 系统下双击 nc-pack.bat 进行打包。

打包后的完整固件 update.img 保存在当前 Output 目录下。
